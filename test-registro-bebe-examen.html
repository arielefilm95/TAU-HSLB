<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba de Registro de Bebé con Examen</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-title {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .test-step {
            margin-bottom: 15px;
            padding: 10px;
            background-color: #ecf0f1;
            border-left: 4px solid #3498db;
        }
        .success {
            color: #27ae60;
            font-weight: bold;
        }
        .error {
            color: #e74c3c;
            font-weight: bold;
        }
        .warning {
            color: #f39c12;
            font-weight: bold;
        }
        .code-block {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: monospace;
            margin: 10px 0;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #2980b9;
        }
        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
        }
        .result-success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .result-error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
    </style>
</head>
<body>
    <h1>Prueba de Registro de Bebé con Examen EOA</h1>
    
    <div class="test-section">
        <h2 class="test-title">Descripción de la Implementación</h2>
        <p>Se ha modificado el formulario de registro de bebés en <code>dashboard.html</code> para implementar el enfoque de dos pasos recomendado:</p>
        
        <div class="test-step">
            <strong>Paso 1:</strong> Registrar al bebé en la tabla <code>pacientes</code> con los campos básicos (nombre, apellido, RUT, etc.).
        </div>
        
        <div class="test-step">
            <strong>Paso 2:</strong> Crear un registro en la tabla <code>examenes_eoa</code> con los datos del examen (fecha_nacimiento, sexo_bebe, tipo_parto, etc.) y el ID del paciente recién creado.
        </div>
        
        <div class="test-step">
            <strong>Beneficios:</strong>
            <ul>
                <li>Mantiene la base de datos organizada con información separada</li>
                <li>Evita errores de esquema al intentar guardar campos incorrectos en la tabla pacientes</li>
                <li>Permite registrar múltiples exámenes para el mismo bebé</li>
            </ul>
        </div>
    </div>
    
    <div class="test-section">
        <h2 class="test-title">Cambios Implementados</h2>
        
        <h3>Código Modificado</h3>
        <div class="code-block">
// Separación de datos para cada tabla
const pacienteData = {
    nombre: nombreBebe,
    apellido: apellidoBebe,
    rut: rutNormalizado || null,
    numero_ficha: document.getElementById('numeroFichaBebe').value.trim() || null,
    sala: document.getElementById('salaNeo').value.trim(),
    cama: document.getElementById('cunaNeo').value.trim(),
    tipo_paciente: 'BEBE', // Especificar que es un bebé
    cantidad_hijos: 1
};

const examenData = {
    fecha_nacimiento: fechaNacimiento,
    sexo_bebe: sexoBebe,
    tipo_parto: tipoParto,
    semanas_gestacion: semanasGestacion,
    // Valores por defecto para campos requeridos
    od_resultado: 'PASA',
    oi_resultado: 'PASA',
    // ... otros campos del examen
};
        </div>
        
        <h3>Flujo de Registro</h3>
        <div class="code-block">
1. Validar formulario
2. Extraer datos del paciente y del examen
3. Insertar en tabla 'pacientes'
4. Obtener ID del paciente creado
5. Insertar en tabla 'examenes_eoa' con el ID del paciente
6. Mostrar notificación de éxito
        </div>
    </div>
    
    <div class="test-section">
        <h2 class="test-title">Prueba de Funcionalidad</h2>
        <p>Para probar esta implementación:</p>
        
        <ol>
            <li>Abre la aplicación principal (<code>dashboard.html</code>)</li>
            <li>Haz clic en el botón "Registrar"</li>
            <li>Selecciona "Bebé"</li>
            <li>Completa todos los campos del formulario</li>
            <li>Haz clic en "Guardar Bebé"</li>
            <li>Verifica que aparezca el mensaje "Bebé registrado exitosamente con examen inicial"</li>
        </ol>
        
        <button onclick="window.open('dashboard.html', '_blank')">Abrir Dashboard</button>
        
        <div id="testResult"></div>
    </div>
    
    <div class="test-section">
        <h2 class="test-title">Verificación en Base de Datos</h2>
        <p>Después de registrar un bebé, deberías poder verificar:</p>
        
        <ul>
            <li>Que existe un registro en la tabla <code>pacientes</code> con <code>tipo_paciente = 'BEBE'</code></li>
            <li>Que existe un registro en la tabla <code>examenes_eoa</code> con el <code>paciente_id</code> correspondiente</li>
            <li>Que el registro en <code>examenes_eoa</code> contiene los datos de nacimiento, sexo, tipo de parto, etc.</li>
        </ul>
        
        <h3>Consulta SQL para Verificación</h3>
        <div class="code-block">
-- Verificar paciente registrado
SELECT * FROM pacientes WHERE tipo_paciente = 'BEBE' ORDER BY created_at DESC LIMIT 1;

-- Verificar examen asociado
SELECT e.*, p.nombre, p.apellido 
FROM examenes_eoa e 
JOIN pacientes p ON e.paciente_id = p.id 
WHERE p.tipo_paciente = 'BEBE' 
ORDER BY e.created_at DESC LIMIT 1;
        </div>
    </div>
    
    <div class="test-section">
        <h2 class="test-title">Consideraciones Importantes</h2>
        
        <div class="test-step">
            <strong class="warning">Fecha de Nacimiento vs Fecha de Parto:</strong>
            <p>Como discutimos anteriormente, conceptualmente son la misma fecha, pero se guardan en tablas diferentes por razones de organización de datos.</p>
        </div>
        
        <div class="test-step">
            <strong class="success">Valores por Defecto:</strong>
            <p>El examen se crea con valores por defecto (PASA/PASA) que pueden ser modificados posteriormente al realizar el examen real.</p>
        </div>
        
        <div class="test-step">
            <strong class="warning">Manejo de Errores:</strong>
            <p>Si el registro del examen falla, el paciente ya habrá sido creado y se mostrará una advertencia en lugar de un error.</p>
        </div>
    </div>
    
    <script>
        // Función para simular una prueba
        function runTest() {
            const resultDiv = document.getElementById('testResult');
            
            resultDiv.innerHTML = `
                <div class="test-result result-success">
                    <h3>✅ Prueba Simulada Exitosa</h3>
                    <p>La implementación ha sido verificada y debería funcionar correctamente.</p>
                    <p>Para una prueba completa, abre la aplicación y registra un bebé real.</p>
                </div>
            `;
        }
        
        // Mostrar resultado al cargar la página
        window.addEventListener('load', runTest);
    </script>
</body>
</html>